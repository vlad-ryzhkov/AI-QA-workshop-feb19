# Аудит: Registration API v1

**Спецификация:** `specifications/specifications_v1/registration_api_v1.md`
**Дата:** 2026-02-05

## Summary

**Спецификация НЕ готова к разработке.** Обнаружено **2 Blocker**, **4 Critical**, **5 Normal** дефектов. Критические проблемы: рассинхрон между схемой и примером (поле `nickname`), отсутствие спецификации ответов и OTP-флоу. Требуется уточнение у PO перед стартом.

---

## Дефекты требований

### Blocker (2)

| # | Слой | Проблема | Рекомендация |
|---|------|----------|--------------|
| 1 | Contract | Поле `nickname` в примере, но отсутствует в таблице схемы | Синхронизировать: добавить в схему или удалить из примера |
| 2 | Contract | **Отсутствует Response Schema** — не описаны коды ответов, тело успеха/ошибки | Добавить секцию Responses: 201, 400, 409, 422 с JSON-примерами |

### Critical (4)

| # | Слой | Проблема | Рекомендация |
|---|------|----------|--------------|
| 3 | Security | Пароль в примере `Alex_2026!` содержит `Alex` = часть `full_name` → нарушает собственное правило "ЗАПРЕЩЕНО" | Заменить на валидный пример: `Secure#2026!` |
| 4 | Business | **OTP Flow не специфицирован**: куда слать SMS (поле phone отсутствует)? Timeout? Retry? Endpoint верификации? | Описать полный OTP-флоу или убрать упоминание |
| 5 | Validation | Нет минимальной длины для `full_name` — допустим ли пустой/1 символ? | Указать min_length (например, 2) |
| 6 | Security | Нет rate-limiting на публичный endpoint — риск brute-force / DoS при регистрации | Добавить NFR: X requests/min per IP |

### Normal (5)

| # | Слой | Проблема | Рекомендация |
|---|------|----------|--------------|
| 7 | Validation | `email`: "Valid email" — двусмысленно (RFC 5321? С `+`? Unicode local-part?) | Указать конкретный regex или RFC |
| 8 | Security | Нет требований по case-sensitivity email (`Alex@` vs `alex@`) | Указать: lowercase при сохранении? |
| 9 | Validation | Спецсимволы в пароле — какие именно? (`!@#$%^&*` или любые non-alphanumeric?) | Перечислить допустимые символы |
| 10 | Business | Нет требований к полю `full_name`: разделитель имя/фамилия? Emoji допустимы? | Указать формат и запрещённые символы |
| 11 | GDPR | Нет упоминания логирования/маскирования PII (email, phone) | Добавить требования к аудит-логам |

---

## Вопросы к PO

1. **Поле `nickname`** — это обязательное поле или пример ошибочен?
2. **SMS OTP**: откуда берётся номер телефона? Нужен ли эндпоинт `POST /verify-otp`?
3. **Email case-sensitivity**: `User@Mail.com` и `user@mail.com` — один пользователь или разные?
4. **Дубликат email**: какой HTTP-код (409 Conflict?) и тело ответа?
5. **Rate-limit**: сколько запросов в минуту допустимо с одного IP?
6. **Пароль — допустимые спецсимволы**: конкретный список или "любые кроме пробела"?
7. **Длина `nickname`** (если поле нужно): min/max ограничения, уникальность?

---

**Рекомендация:** После получения ответов запустить `/testcases` для генерации тест-кейсов.

# Запрос к ИИ (Gemini 3 "fast"): подготовь тест кейсы для требований
---

# Ответ ИИ (Анализ спецификации v1)
Вот детальный набор тест-кейсов для спецификации API Регистрации Пользователей v1, разделенный по категориям.
---
## 1. Позитивные сценарии (Positive Tests)

**TC-01: Успешная регистрация с валидными данными.**
- **Вход:** Полный JSON из примера (`email`, `password`, `full_name`, `nickname`).
- **Ожидаемый результат:** HTTP 201 Created. В базе создана запись, статус аккаунта "Pending", инициирована отправка SMS с OTP.

> **ОШИБКА 1 (Ghost Trap):** Галлюцинация. ИИ пишет "отправка SMS", но в JSON нет поля `phone`. Слать СМС некуда. 
> Требование невыполнимо.

> **ОШИБКА 2 (Security Trap):** ИИ пишет "Вход: JSON из примера". В примере пароль `Alex_2026!`, а имя `Alex Kid`. 
> Согласно правилам безопасности (которые ИИ сам же описал ниже в TC-07), этот запрос должен вернуть 400, а не 201. 
> ИИ не проверил валидность примера в документации.

> **ОШИБКА 3 (Garbage Trap):** ИИ включил поле `nickname` в валидный запрос, просто скопировав его из примера. 
> Он проигнорировал таблицу схемы данных, где этого поля нет.

**TC-02: Поддержка UTF-8 в имени.**
- **Вход:** `full_name`: "Иван Смирнов", `password`: "Safe_Pass77!".
- **Ожидаемый результат:** HTTP 201 Created. Данные корректно отображаются в БД в кодировке UTF-8.

**TC-03: Регистрация с минимально допустимым паролем.**
- **Вход:** Пароль из 8 символов, включая цифру и спецсимвол (например, `Ab1!aaaa`).
- **Ожидаемый результат:** HTTP 201 Created.

---
## 2. Проверка бизнес-логики (Business Rules)

**TC-04: Проверка уникальности Email.**
- **Предусловие:** Пользователь с `email`: "test@ex.com" уже существует.
- **Вход:** Повторная регистрация с тем же email.
- **Ожидаемый результат:** HTTP 409 Conflict. Сообщение об ошибке: "Email already exists".

**TC-05: Валидация OTP Flow.**
- **Действие:** Вызов метода регистрации.
- **Ожидаемый результат:** Проверка интеграции (Mock или Logs), что сервис SMS получил запрос на отправку OTP кода для указанного номера/аккаунта.

> **КОММЕНТАРИЙ:** ИИ снова упоминает "указанный номер", хотя в спецификации нет способа его указать. 
> Это демонстрирует поверхностное чтение: увидел слово "SMS" → придумал тест, не глядя на структуру данных.

---
## 3. Безопасность пароля (NIST & Social Engineering)

**TC-06: Запрет использования частей Email в пароле.**
- **Вход:** `email`: "ivanov@mail.ru", `password`: "Ivanov_2026!".
- **Ожидаемый результат:** HTTP 400 Bad Request. Ошибка: "Password contains parts of email".

**TC-07: Запрет использования Имени в пароле.**
- **Вход:** `full_name`: "Alex Kid", `password`: "Alex_2026!".
- **Ожидаемый результат:** HTTP 400 Bad Request. Ошибка: "Password contains parts of name".

> **КОММЕНТАРИЙ (Logical Contradiction):** В этом тесте ИИ правильно говорит, что `Alex Kid` + `Alex_2026!` = Ошибка 400. 
> Но в TC-01 он взял ровно эти же данные (из примера документации) и сказал, что будет "201 Успех". 
> Вывод: ИИ не сопоставил позитивный и негативный сценарии.

**TC-08: Отсутствие спецсимволов или цифр.**
- **Вход:** `password`: "OnlyLetters".
- **Ожидаемый результат:** HTTP 400 Bad Request. Ошибка валидации сложности пароля.

**TC-09: Длина пароля менее 8 символов.**
- **Вход:** `password`: "Short1!".
- **Ожидаемый результат:** HTTP 400 Bad Request.

---

## 4. Валидация полей (Negative Tests)

**TC-10: Отсутствие обязательного поля (email).**
- **Вход:** JSON только с `password` и `full_name`.
- **Ожидаемый результат:** HTTP 400 Bad Request. Ошибка: "Email is required".

**TC-11: Невалидный формат Email.**
- **Вход:** `email`: "alex.kid@com" (без точки в домене) или `email`: "alex@@ex.com".
- **Ожидаемый результат:** HTTP 400 Bad Request.

**TC-12: Превышение длины full_name.**
- **Вход:** `full_name` строкой более 100 символов.
- **Ожидаемый результат:** HTTP 400 Bad Request.

---

## 5. Граничные значения и типы данных

**TC-13: Пустые строки в обязательных полях.**
- **Вход:** `{"email": "", "password": "", "full_name": ""}`.
- **Ожидаемый результат:** HTTP 400 Bad Request.

**TC-14: Передача лишних полей.**
- **Вход:** JSON с дополнительным полем `"role": "admin"`.
- **Ожидаемый результат:** HTTP 201 Created (если API игнорирует неизвестные поля) ИЛИ 400. Роль "admin" не должна быть присвоена.

---------------------------------------------------
> **КОММЕНТАРИИ: Статистика качества тест-кейсов**

## Сравнение: Raw AI vs Prompted AI

**Raw AI (этот файл):**
- Сгенерировано: 14 из 28 необходимых
- Корректных: 12 из 14 (2 с критичными багами)
- **Итоговое покрытие: 12/28 = 43%**
- Покрытие BVA: частичное
- Security тесты: 2
---

### Что пропустил Raw AI (14 тестов → должно быть 28+)

**Пропущенные категории:**
- ❌ Обязательность полей phone, password, full_name (только email проверен)
- ❌ BVA границы full_name (min=2, max=100, min-1, max+1)
- ❌ BVA пароль ровно 8 символов (Happy Path граница)
- ❌ Валидация phone (без +, с буквами, короткий/длинный)
- ❌ Пароль без заглавных букв
- ❌ 409 Conflict для дублирования телефона
- ❌ 429 Rate Limiting (5 req/min)
- ❌ UTF-8/Emoji в full_name
- ❌ XSS protection (`<script>` в имени)
- ❌ SQL Injection в email
- ❌ Extra fields игнорируются (роль admin)

**Итого пропущено:** ~16 сценариев (корректных только **12 из 28 = 43%**)

---

### Вывод

> **Критичность: ВЫСОКАЯ.**
>
> **Количественно:** ИИ без контекста сгенерировал 14 тестов, из них 2 с критичными багами. 
> Корректных: **12 из 28 необходимых = 43% покрытия**.
>
> **Качественно:** 2 теста (TC-01, TC-05) содержат критические ошибки:
> 1. Сделают тесты неисполняемыми (Ghost Trap)
> 2. Пропустят уязвимость в продакшн (Security Trap)
>
> **Root Cause:** ИИ не построил целостную картину — нашёл правило безопасности (TC-07), 
> но не применил его к примеру из документации (TC-01).
>
> **Решение:** Использование структурированного контекста (`CLAUDE.md` + Skills) даёт **28 тестов с 100% корректностью** 
> вместо 12 корректных из 14.

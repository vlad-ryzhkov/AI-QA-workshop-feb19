# QA Профили — Core Principles и Anti-Patterns

> **Назначение:** Справочник принципов и анти-паттернов для разных типов тестирования. Используется в `/init-agent` для генерации qa_agent.md под конкретный профиль.

---

## Универсальные принципы (для всех профилей)

```markdown
1. **Trust No One** — проверяй требования на противоречия
2. **Isolation First** — тесты не зависят друг от друга
3. **Cleanup Always** — удаляй созданные данные
4. **Fail Fast** — падай рано, падай громко
5. **Evidence-Based** — каждый баг с доказательствами
```

---

## API Testing

### Core Principles

```markdown
1. **Contract First** — тест проверяет контракт, не реализацию
2. **Boundary Obsession** — граничные значения важнее happy path
3. **Negative > Positive** — негативных сценариев больше
4. **Idempotency Check** — повторный запрос = тот же результат
```

### Anti-Patterns

```markdown
| ❌ Плохо | ✅ Хорошо | Почему |
|----------|-----------|--------|
| Хардкод endpoint URL | Конфигурация через env | Переносимость |
| Игнорировать статус код | Проверка точного кода | Контракт |
| Один assert на тест | Структурированные проверки | Полнота |
| Тестировать реализацию | Тестировать контракт | Гибкость |
```

---

## UI/E2E Testing

### Core Principles

```markdown
1. **User Perspective** — думай как пользователь
2. **Stable Selectors** — data-testid лучше CSS классов
3. **Visual Regression** — скриншоты критичных экранов
4. **Flaky = Bug** — нестабильный тест — это баг теста
```

### Anti-Patterns

```markdown
| ❌ Плохо | ✅ Хорошо | Почему |
|----------|-----------|--------|
| XPath селекторы | data-testid | Стабильность |
| Хардкод ожиданий | Polling с условием | Синхронизация |
| Скриншоты везде | Скриншоты критичных мест | Скорость |
| Один длинный тест | Атомарные сценарии | Отладка |
```

---

## Performance Testing

### Core Principles

```markdown
1. **Baseline First** — сначала измерь, потом оптимизируй
2. **Realistic Load** — профиль нагрузки из продакшена
3. **Percentiles > Average** — p95/p99 важнее среднего
4. **Resource Monitoring** — CPU/RAM/IO во время теста
```

### Anti-Patterns

```markdown
| ❌ Плохо | ✅ Хорошо | Почему |
|----------|-----------|--------|
| Только среднее время | Перцентили p95/p99 | Реальная картина |
| Константная нагрузка | Постепенное нарастание | Реалистичность |
| Игнорировать ресурсы | Мониторинг CPU/RAM/IO | Узкие места |
| Тестировать на laptop | Production-like окружение | Точность |
```

---

## Security Testing

### Core Principles

```markdown
1. **OWASP Top 10** — минимальный чек-лист
2. **AuthZ ≠ AuthN** — авторизация и аутентификация разные вещи
3. **Trust Nothing** — все входные данные потенциально вредоносны
4. **Least Privilege** — минимум прав для работы
```

### Anti-Patterns

```markdown
| ❌ Плохо | ✅ Хорошо | Почему |
|----------|-----------|--------|
| Хардкод credentials | Секреты в vault | Безопасность |
| Игнорировать SQL injection | Параметризованные запросы | XSS/SQLi |
| Доверять входным данным | Валидация + санитизация | Injection attacks |
| Админские токены в тестах | Минимальные права | Least Privilege |
```

---

## Универсальные Anti-Patterns (для всех профилей)

```markdown
| ❌ Плохо | ✅ Хорошо | Почему |
|----------|-----------|--------|
| Thread.sleep() | Polling с таймаутом | Flaky тесты |
| Хардкод ID/email | UUID/timestamp генерация | Коллизии |
| Общие тестовые данные | Изолированные данные | Зависимости |
| Игнорировать cleanup | try-finally | Мусор в системе |
| assertEquals без msg | assertEquals с msg | Отладка в CI |
| var вместо val | val везде | Иммутабельность |
| Catch без обработки | Логирование + rethrow | Потеря информации |
| Магические числа | Именованные константы | Понятность |
```

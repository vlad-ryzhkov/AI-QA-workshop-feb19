---
name: analyze
description: Проводит глубокий QA-аудит спецификации на основе стандартов ISTQB, BABOK и OWASP. Находит противоречия, проблемы безопасности и пробелы в бизнес-логике.
---

# Expert Requirements Analysis & Audit

Этот навык проводит всесторонний анализ требований, эмулируя работу Senior QA Architect.

## Алгоритм работы

1. **Контекстный анализ:** Определи домен (FinTech, E-commerce, Mobile и т.д.) по содержимому.
2. **Сканирование:** Примени эвристики из чек-листа ниже.
3. **Cross-Check:** Если предоставлены или есть доступ к другим требованиям, проверь на противоречия с ними.
4. **Отчетность:** Выведи таблицу дефектов требований и список вопросов.

## Глубокий Чек-лист (Industry Standards)

### 1. Качество и Тестируемость (ISTQB)
- [ ] **Недвусмысленность:** Есть ли формулировки "и/или", "и т.д.", "как обычно", "приемлемое время"? Требуй однозначности.
- [ ] **Атомарность и Прослеживаемость (Traceability):** У каждого требования должен быть уникальный ID. Смешиваются ли UI и Backend логика?
- [ ] **Критерии приемки (AC):** Можно ли написать тест, который однозначно скажет Pass/Fail?
- [ ] **Полнота (Completeness):** Рассмотрены ли сценарии `Empty`, `Null`, `Zero`, `Negative` для всех данных?

### 2. Безопасность и Доступы (OWASP ASVS)
- [ ] **IDOR (Insecure Direct Object References):** Проверяется ли, что user_id в URL принадлежит текущему пользователю?
- [ ] **Ввод данных:** Есть ли требования по санитайзингу (XSS), длине полей (DoS) и кодировке (UTF-8/Emoji)?
- [ ] **PII/GDPR:** Есть ли требования по маскированию чувствительных данных в логах и UI?
- [ ] **AuthZ/AuthN:** Четко ли описаны роли? Что видит "Гость" vs "Админ"?

### 3. Архитектура и Интеграция (System Design)
- [ ] **Идемпотентность:** Что будет при повторной отправке того же POST запроса (retry)?
- [ ] **Обратная совместимость:** Ломает ли это изменение старые клиенты мобильного приложения?
- [ ] **Нагрузка (NFRs):** Указаны ли требования по RPS, Latency (p99) и таймаутам?
- [ ] **Согласованность (Consistency):** Есть ли риск Eventual Consistency? Как интерфейс реагирует на задержку обновления данных?

### 4. Бизнес-логика и Состояния (BABOK)
- [ ] **Диаграмма состояний:** Описаны ли все переходы? (Например: из `Pending` можно в `Cancelled`, а из `Paid` в `Cancelled` — нельзя).
- [ ] **Краевые бизнес-случаи:** Смена часовых поясов, переход через полночь, валютные округления.
- [ ] **Влияние (Impact Analysis):** Затрагивает ли эта фича биллинг, отчетность или нотификации?

## Формат вывода (COMPACT)

**Правила:**
- Максимум 15 дефектов в отчёте (топ по критичности)
- Максимум 7 вопросов к PO
- Без диаграмм и ASCII-art
- Без секции "недостающие шаблоны" (только если явно запрошено)

### 1. Summary (3-5 строк)
Кратко: сколько Blocker/Critical, готова ли спека к разработке.

### 2. Таблица дефектов (компактная)
Группируй по приоритету. Колонки: `#`, `Слой`, `Проблема`, `Рекомендация`.

```
### Blocker (N)
| # | Слой | Проблема | Рекомендация |
|---|------|----------|--------------|
| 1 | Contract | Поле X в примере, но нет в схеме | Синхронизировать |
```

### 3. Вопросы к PO (max 7)
Только критичные вопросы, блокирующие тестирование. Без группировки по темам.

---

## Промпты для генерации специализированных версий этого файла

Используй эти промпты, чтобы адаптировать навык под конкретные нужды.

### 1. Адаптация под Домен (Domain Specific)
> "Модифицируй `analyze/SKILL.md` для домена **[FinTech / Healthcare / Booking]**. Добавь проверки:
> * FinTech: транзакционная целостность, округление (Double vs Decimal), PCI DSS.
> * Healthcare: HIPAA/152-ФЗ, разделение доступа к медкарте.
> * Booking: овербукинг, блокировка слотов, часовые пояса."

### 2. Анализ влияния (Impact Analysis)
> "Добавь шаг Cross-Check для двух файлов: `new_feature.md` и `legacy_logic.md`.
> Проверки: противоречия с существующей логикой, deprecated API, миграция БД."

### 3. NFR на основе ISO 25010
> "Расширь блок NFR: Performance Efficiency, Reliability, Usability, Maintainability."

### 4. BDD-style вывод
> "Переформулируй нечёткие требования в Gherkin (Given/When/Then)."

---

## Self-Check (перед завершением анализа)

- [ ] **Completeness:** Все секции чек-листа проверены?
- [ ] **Prioritization:** Проблемы отсортированы (Blocker > Critical > Normal)?
- [ ] **Actionable:** Каждая проблема имеет рекомендацию?
- [ ] **Questions:** Вопросы можно ответить да/нет или выбрать вариант?
